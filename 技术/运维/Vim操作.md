`Vim` 是从 `vi` 发展出来的一个文本编辑器。其代码补完、编译及错误跳转等方便编程的功能特别丰富，在程序员中被广泛使用。和 `Emacs` 并列成为类 `Unix` 系统用户最喜欢的编辑器。

## Vim 常用模式

- 交互模式
- 插入模式
- 命令模式
- 可视模式

### 交互模式

也成为正常模式，这是 `Vim` 的默认模式，每次运行 `Vim` 程序的时候，就会进入这个模式。

例如执行 `vim name.txt` 则会进入交互模式。

交互模式特征：

- 在这个模式下，不能输入文本；
- 它可以让我们在文本间移动，删除一行文本，复制黏贴文本，跳转到指定行，撤销操作，等等。

### 插入模式

这个模式是我们熟悉的文本编辑器的模式，就是可以输入任何想输入的内容。进入这个模式有几种方法，最常用的方法是按字母键 `i` （ `i、I、a、A、o、O` 都可以进入插入模式，只是所处的位置不同），退出这种模式，只需要按下 `Esc` 键。

- `i, I` 进入输入模式 `Insert mode` ： `i` 为“从目前光标所在处输入”， `I` 为“在目前所在行的第一个非空格符处开始输入”；
- `a, A` 进入输入模式 `Insert mode` ： `a` 为“从目前光标所在的下一个字符处开始输入”， `A` 为“从光标所在行的最后一个字符处开始输入”；
- `o, O` 进入输入模式 `Insert mode` ： `o` 为“在目前光标所在的下一行处输入新的一行”； `O` 为在目前光标所在处的上一行输入新的一行。

### 命令模式

命令模式也称为底线命令模式，这个模式下可以运行一些命令例如“退出”，“保存”，等动作。

也可以用这个模式来激活一些 `Vim` 配置，例如语法高亮，显示行号，等。甚至还可以发送一些命令给终端命令行，例如 `ls、cp` 。

为了进入命令模式，首先要进入交互模式，再按下冒号键。



## 基本操作

### 打开 Vim

在终端命令行中输入 `vim` 回车后 `Vim` 就会被运行起来，也可以用 `Vim` 来打开一个文件，只需要在 `vim` 后面再加文件名。如 `vim file.name` ，如果文件不存在，那么会被创建。

### 插入

进入文件之后，此时处于交互模式，可以通过输入 `i` 进入插入模式。

### 移动

在 `Vim` 的交互模式下，我们可以在文本中移动光标。

- `h` 向左移动一个字符
- `j` 向下移动一个字符
- `k` 向上移动一个字符
- `i` 向右移动一个字符

当然也可以使用四个方向键进行移动，效果是一样的。

### 跳至行首和行末

- 行首：在交互模式下，为了将光标定位到一行的开始位置，只需要按下数字键 `0` 即可，键盘上的 `Home` 键也有相同效果。
- 行末：在交互模式下，为了将光标定位到一行的末尾，只需要按下美元符号键 `$` 即可，键盘上的 `End` 键也有相同效果。

### 按单词移动

在交互模式下，按字母键 `w` 可以一个单词一个单词的移动。

### 退出文件

在交互模式下，按下冒号键 `:` 进入命令模式，再按下 `q` 键，就可以退出了。

如果在退出之前又修改了文件，就直接想用 `:q` 退出 `Vim` ，那么 `Vim` 会显示一个红字标明错误信息。此时我们有两个选择：

1. 保存并退出 `:wq` 或 `:x` ；
2. 不保存且退出 `:q!` 。

## 标准操作

### 删除字符

在交互模式下，将光标定位到一个你想要删除的字符上，按下字母键 `x` 你会发现这个字符被删除了。

也可以一次性删除多个字符，只需要在按 `x` 键之前输入数字即可。

### 删除（剪切）单词，行

- 删除一行：连按两次 `d` 来删除光标所在的那一行。
- 删除多行：例如先输入数字 `2` ，再按下 `dd` ，就会删除从光标所在行开始的两行。
- 删除一个单词：将光标置于一个单词的首字母处，然后按下 `dw` 。
- 删除多个单词：例如先按数字键 `2` 再按 `dw` 就可以删除两个单词了。
- 从光标所在位置删除至行首： `d0` 。
- 从光标所在位置删除至行末： `d$` 。

### 复制单词，行

- 复制行：按两次 `y` 会把光标所在行复制到内存中，和 `dd` 类似， `dd` 用于“剪切”光标所在行。
- 复制单词： `yw` 会复制一个单词。
- 复制到行末： `y$` 是复制从光标所在处到行末的所有字符。
- 复制到行首： `y0` 是复制光标所在处到行首的所有字符。

### 粘贴

如果之前用 `dd` 或者 `yy` 剪切复制过来的，可以使用 `p` 来粘贴。同样也可以使用 `数字+p` 来表示复制多次。

### 替换一个字符

在交互模式下，将光标置于想要替换的字符上。按下 `r` 键，接着输入你要替换的字符即可。

### 撤销操作

如果要撤销最近的修改，只需要按下 `u` 键，如果想要撤销最近四次修改，可以按下4，再按下 `u` 。

### 重做

取消撤销，也就是重做之前的修改使用 `ctrl + r` 。

### 跳转到指定行

`Vim` 编辑的文件中，每一行都有一个行号，行号从1开始，逐一递增。

行号默认是不显示，如果需要它显示的话，可以进入命令模式，然后输入 `set nu` ，如果要隐藏行号的话，使用 `set nonu` 。

- 跳转到指定行： `数字+gg` ，例如 `7gg` ，表示跳转到第7行。
- 要跳转到最后一行，按下 `G` 。
- 要跳转到第一行，按下 `gg` 。

## 高级操作

### 查找

处于交互模式下，按下 `/` 键，那么就进入查找模式，输入你要查找的字符串，然后按下回车。光标就会跳转到文件中下一个查找到的匹配处。如果字符串不存在，那么会显示 `"pattern not found"` 。

- `n` 跳转到下一个匹配项；
- `N` 跳转到上一个匹配项。

[注意] 用斜杠来进行的查找是从当前光标处开始向文件尾搜索，如果你要从当前光标处开始，向文件头搜索则使用 `?` ，当然也可以先按下 `gg` 跳转到第一行在进行全文搜索。

### 查找并替换

替换光标所在行第一个匹配的字符串：

```
# 语法
:s/旧字符串/新字符串

# 实例
:s/one/two
```

替换光标所在行所有旧字符串为新字符串：

```
# 语法
:s/旧字符串/新字符串/g
```

替换第几行到第几行中所有字符串：

```
# 语法
:n,m s/旧字符串/新字符串/g

# 实例
:2,4 s/one/two/g
```

最常用的就是全文替换了：

```
# 语法
:%s/旧字符串/新字符串/g
```

### 合并文件

可以用冒号 `+r` ( `:r` ) 实现在光标处插入一个文件的内容。

```
:r filename # 可以用Tab键来自动补全另外一个文件的路径
```

### 分屏

`Vim` 有一个特别便捷的功能那就是分屏，可以同时打开好几个文件，分屏之后，屏幕每一块被称为一个 `viewport` ，表示“视口”。

- 横向分屏 `:sp 文件名`
- 垂直分屏 `:vsp 文件名`

#### 分屏模式下的快捷键

- `Ctrl + w` 再加 `Ctrl + w` ，表示从一个 `viewport` 移动光标到另外一个 `viewport` ；
- `Ctrl + w` 再加 “方向键”，就可以移动到这个方向所处的下一个视口了；
- `Ctrl + w` 再加 `+` 号，表示扩大当前视口；
- `Ctrl + w` 再加 `-` 号，表示缩小当前视口；
- `Ctrl + w` 再加 `=` 号，表示平均当前视口；
- `Ctrl + w` 再加 `r` 键，会反向调换视口位置；
- `Ctrl + w` 再加 `q` 键，会关闭当前视口；
- `Ctrl + w` 再加 `o` 键，会关闭除当前视口以外的所有视口；

### 运行外部命令 `:!`

在 `Vim` 中可以运行一些终端命令，只要先输入 `:!` ，然后接命令名称。

例如：

```
:!ls # 在Vim中打开的文件所在的目录运行ls命令
```

### 可视模式

前面只讲了 `Vim` 的三种模式，其实还有一种模式叫做可视模式。

进入它的三种方式（都是从交互模式开始）：

- `v` 字符可视模式，进入后配合方向键选中字符后，然后再按 `d` 键可以删除选中。
- `V` 行可视模式，进入后光标所在行默认被选中，然后再按 `d` 键可以删除所在行。
- `Ctrl + v` 块可视模式，它是可视模式最有用的功能了，配合 `d` 和 `I` 键可以实现删除选中的内容和插入内容。

同时选中多行，并在选中行头部插入内容的具体操作步骤：

```
1. ctrl + v 进入块可视模式
2. 使用方向键进行选中（上下左右）假设选中5行
3. 输入 I 键进行多行同时插入操作
4. 插入完成后连续按两下 esc 键，实现多行同时插入相同字符
```

进入可视模式之后的操作键：

- `d` 键，表示删除选中；
- `I` 键，表示在选中之前插入；
- `u` 键，表示选中变为小写；
- `U` 键，表示选中变为大写；

## Vim 配置

### 选项参数

在 `Vim` 被启动后，可以运行一些指令来激活一些选项参数，但是这些选项参数的配置在退出 `Vim` 时会被忘记，例如前面讲解的激活行号。如果希望所在的配置是永久性的，那么需要在家目录（ `cd ~` ）创建一个 `Vim` 的配置文件 `.vimrc` 。

### .vimrc

```
set number " 显示行号
syntax on " 激活语法高亮
set showcmd " 实时看到输入的命令
set ignorecase " 搜索时不区分大小写
set mouse=a " 激活鼠标，用鼠标选中时相当于进入可视模式
```

`Vim` 配置非常丰富，我们可以通过个性化配置把 `Vim` 打造成属于自己的 `IDE` 等等。在 `github` 上也可以搜索到一些强大的 `Vim` 配置文件。