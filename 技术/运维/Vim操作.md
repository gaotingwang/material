`Vim` 是从 `vi` 发展出来的一个文本编辑器。其代码补完、编译及错误跳转等方便编程的功能特别丰富，在程序员中被广泛使用。和 `Emacs` 并列成为类 `Unix` 系统用户最喜欢的编辑器。

## Vim 常用模式

- normal模式
- 插入模式
- 命令模式
- 可视模式

### normal模式

也称为正常模式/交互模式，这是 `Vim` 的默认模式，每次运行 `Vim` 程序的时候，就会进入这个模式。

例如执行 `vim name.txt` 则会进入normal模式。

normal模式特征：

- 在这个模式下，不能输入文本；
- 它可以让我们在文本间移动，删除一行文本，复制黏贴文本，跳转到指定行，撤销操作，等等。

### 插入模式

这个模式是我们熟悉的文本编辑器的模式，就是可以输入任何想输入的内容。进入这个模式有几种方法，最常用的方法是按字母键 `i` （ `i、I、a、A、o、O` 都可以进入插入模式，只是所处的位置不同），退出这种模式，只需要按下 `Esc` 键。

- `i, I` 进入输入模式 `Insert mode` ： `i` 为“从目前光标所在的前一个字符处开始输入”， `I` 为“在目前所在行的第一个非空格符处开始输入”；
- `a, A` 进入输入模式 `Insert mode` ： `a` 为“从目前光标所在的下一个字符处开始输入”， `A` 为“从光标所在行的最后一个字符处开始输入”；
- `o, O` 进入输入模式 `Insert mode` ： `o` 为“在目前光标所在的下一行处输入新的一行”； `O` 为在目前光标所在处的上一行输入新的一行。

### 命令模式

命令模式也称为底线命令模式，这个模式下可以运行一些命令例如“退出”，“保存”，等动作。

也可以用这个模式来激活一些 `Vim` 配置，例如语法高亮，显示行号，等。甚至还可以发送一些命令给终端命令行，例如 `ls、cp` 。

为了进入命令模式，首先要进入normal模式，再按下冒号键 `:`。

### 可视化模式

可视化模式一般用来块状选择文本。

在normal模式下输入 `v` 进入可视化模式，`V` 进入可视化行模式，`ctrl + v` 进行方块选择。可以通过方向键来进行选中内容，来进行相关操作

同时选中多行，并在选中行头部插入内容的具体操作步骤：

```
1. ctrl + v 进入块可视模式
2. 使用方向键进行选中（上下左右）假设选中5行
3. 输入 I 键进行多行同时插入操作
4. 插入完成后连续按两下 esc 键，实现多行同时插入相同字符
```

进入可视模式之后的操作键：

- `d` 键，表示删除选中；
- `I` 键，表示在选中之前插入；
- `u` 键，表示选中变为小写；
- `U` 键，表示选中变为大写；



## 插入模式操作

### 打开 Vim

在终端命令行中输入 `vim` 回车后 `Vim` 就会被运行起来，也可以用 `Vim` 来打开一个文件，只需要在 `vim` 后面再加文件名。如 `vim file.name` ，如果文件不存在，那么会被创建。

### 通用操作

- `ctrl + h` 删除上一个字符
- `ctrl + w ` 删除上一个单词
- `ctrl + u` 删除当前行

### 插入

进入文件之后，此时处于normal模式，可以通过输入 `i` 进入插入模式。

### 快速切换insert和normal模式

`Esc` 按起来不方便，不方便模式的快速切换

- 使用 `ctrl + c` 代替 `Esc` ，缺点是可能会中断默写插件，或者使用 `ctrl + [`
- `gi` 快速跳转到最后一次编辑的地方并进行插入模式
- 可以自己配置映射快捷键来代替`Esc`  



## 移动操作

### 移动

在 `Vim` 的normal模式下，我们可以在文本中移动光标。

- `h` 向左移动一个字符（h 位于左边，每次按下就会向左移动）
- `l` 向右移动一个字符（l 位于右边，每次按下就会向右移动）
- `j` 向下移动一个字符（j 看起来像一支尖端向下的箭头）
- `k` 向上移动一个字符

### 单词间移动

- `w/W` 移动到下一个 `word/WORD` 开头，`e/E` 移动到下一个 `word/WORD` 结尾
- `b/B` 移动到上一个 `word/WORD` 开头
- `word`是指以非空白符分割的单词，`WORD`是以空白符分割的单词

### 跳至行首和行末

- 行首：数字键 `0` 移动到行首第一个字符，`^` 移动到第一个非空白字符
- 行末： `$` 键移动到行尾，`g_`移动到行尾非空白字符

### 搜索移动

同一行搜索快速移动：就是搜索一个字符并且移动到该字符

- 使用`f{char}`可以移动到该char字符上
- 使用`t{char}`可以移动到该char字符的前一个字符
- 如果搜索结果不是期望的，可以使用（`;`/`,`），继续该搜索的下一个 / 上一个
- 大写 F 表示向前搜索字符

### 页面移动

- `gg/G` 移动到文件开头/结尾，可以使用`ctrl + o` 返回上一个位置

  跳转到指定行： `数字+gg` ，例如 `7gg` ，表示跳转到第7行。

- `H/M/L`跳转到屏幕的开头(Head)、中间(Middle)和结尾(Lower)

- `ctrl + u / f` 上下翻页（upward / forward），`zz`把光标位置放在屏幕中间



## 增删改查

### 删除

- vim在normal模式下，使用`x`快速删除一个字符

- 使用`d`(delete) 配合文本对象删除一个单词，`dw` = `daw`(delete around word) 删除单词后的空格，`diw`只删除单词，不删除空格

  - 删除一行：连按两次 `d` 来删除光标所在的那一行。
  - 删除多行：例如先输入数字 `2` ，再按下 `dd` ，就会删除从光标所在行开始的两行。
  - 删除一个单词：将光标置于一个单词的首字母处，然后按下 `dw` 。
  - 删除多个单词：例如先按数字键 `2` 再按 `dw` 就可以删除两个单词了。
  - `dt{char}`（delete to {char}） 从当前光标删到指定字符（不包括指定字符）。
  - 从光标所在位置删除至行首： `d0` 。
  - 从光标所在位置删除至行末： `d$` 。

- d和x可以搭配数字来执行多次

  也可以一次性删除多个字符，只需要在按 `x` 键之前输入数字即可

### 修改

常用有三个，`r`(replace)、`c`(change)、`s`(substitute)

- normal模式下，`r`可以替换一个字符，`R`可以进行后续字符的替换

- `s`删除当前字符并进入插入模式，`S`整行删除进入插入模式

- 使用`c`配合文本对象，可以快速进行修改，`C`整行删除进入插入模式

  与`s`功能相似，删除当前字符进入插入模式，`cw` 删除一个单词进入插入模式 、`ct{char}`

  `ci[()<>{}[]"']` inner word（不包括单词前后空格）

  `ca[()<>{}[]"']` around word（包括单词前后空格）

### 查找

处于normal模式下，按下 `/` 键，就进入查找模式，输入要查找的字符串，然后按下回车。光标就会跳转到文件中下一个查找到的匹配处。如果字符串不存在，那么会显示 `"pattern not found"` 。

- `n` 跳转到下一个匹配项；
- `N` 跳转到上一个匹配项。

[注意] 用`/`来进行的查找是从当前光标处开始向文件尾搜索，如果要从当前光标处开始，向文件头搜索则使用 `?` ，当然也可以先按下 `gg` 跳转到第一行在进行全文搜索。

使用 `*` 或者 `#` 可以对当前光标所在单词，进行向后和向前匹配

`:set hls` 设置搜索匹配项高亮

`:set incsearch` 设置增量搜索， 

### 查找并替换

替换光标所在行第一个匹配的字符串，`s`(substitute) 命令

```
# 语法
:s/旧字符串/新字符串

# 实例
:s/one/two
```

替换光标所在行所有旧字符串为新字符串：

```
# 语法
:s/旧字符串/新字符串/g
```

flag常用标志：

- `g`(global) 标识全局范围内执行
- `c`(confirm) 表示确认，可以确认或拒绝
- `n`(number) 报告匹配到的次数而不替换，用来查询匹配次数

替换第几行到第几行中所有字符串：

```
# 语法
:n,m s/旧字符串/新字符串/g

# 实例
:2,4 s/one/two/g
```

直接输入% 代表全文，最常用的就是全文替换了：

```
# 语法
:% s/旧字符串/新字符串/g
```

### 复制粘贴

在normal模式下，使用 `y(yank)` 可以复制到内存中。可以使用 `p` 来粘贴之前用 `dd` 或者 `yy` 剪切复制过来的内容。同样也可以使用 `数字+p` 来表示粘贴多次。

- 通常使用`v`(可视化模式) 选中要复制的内容，然后执行复制
- 复制单词： `yiw` 会复制一个单词。
- 复制行：`yy`光标所在行复制到内存中，和 `dd` 类似， `dd` 用于“剪切”光标所在行。
- 复制到行末： `y$` 是复制从光标所在处到行末的所有字符。
- 复制到行首： `y0` 是复制光标所在处到行首的所有字符。

vim与其他编辑器不同，复制剪切操作的是寄存器而不是系统剪切板。

- 可以使用`"{register}` 指定寄存器，不指定就使用默认的寄存器
  - `"0` 复制专用寄存器
  - `"+`系统剪切板
  - `:set clipboard=unnamed` 可以直接复制粘贴系统剪切板中的内容
- `"ayiw` 复制一个单词到 a 寄存器，`"ap` 从 a 寄存器粘贴内容
- `:reg {register}`  可以查看{register}寄存器中的内容

在insert模式下，一般使用`ctrl + c/v`来进行复制粘贴，但很多人在`.vimrc`设置了autoindent，代码缩进会错乱，可以使用`:set paste`和`:set nopaste`来解决。

### 撤销操作

如果要撤销最近的修改，只需要按下 `u` 键，如果想要撤销最近四次修改，可以按下4，再按下 `u` 。

大`U` 撤销当前行上的所有修改。

### 重做

取消撤销，也就是重做之前的修改使用 `ctrl + r` 。

### 退出文件

在normal模式下，按下冒号键 `:` 进入命令模式，再按下 `q` 键，就可以退出了。

如果在退出之前又修改了文件，就直接想用 `:q` 退出 `Vim` ，那么 `Vim` 会显示一个红字标明错误信息。此时我们有两个选择：

1. 保存并退出 `:wq` 或 `:x` 
2. 不保存且退出 `:q!` 
3. 重新加载并不保存当前文件`:e!`



## 高级操作

### 文本对象

很多其他编辑器，只能操作单个字符来修改文本，比较低效。text object 要操作的文本对象，如单词(`w`)、句子(`s`)、段落(`p`)，要比只操作单个字符高效。

### 使用宏进行批量操作

宏可以看成是一系列命令的集合，可以使用宏“录制”一系列操作，然后“回放”命令在多行文本上

- 使用`q`来录制，同时也是q结束录制
- 使用`q{register}`使用指定寄存器录制
- 使用`@{register}`回放寄存器中保存的一系列命令

举例：批量给每行数据前后加上引号

- 首先在第一行，`qa`开启宏录制
- `I`进入插入模式，光标位于行首，输入`"`；`Esc`进入normal模式；`A`进入插入模式，光标位于行尾，输入`"`；`Esc`回到normal模式
- `q`结束录制
- 进入下一行，`v`进行可视化行选择，`G`选择到文件结尾
- `:`进入命令模式，输入`normal @a` 回放宏命令

### 多文件操作

- buffer：vim打开一个文件后，会加载文件内容到缓冲区，之后的修改都是针对缓冲区的修改，并不会直接保存到文件，直到执行`:w` 才会把修改内容更新到文件中
  - 使用`:ls`会列举当前缓冲区，然后使用`:b {n}`跳转到第n个缓冲区
  - `:bpre` 跳转上一个、`:bnext` 跳转下一个、`:bfirst` 跳转第一个、`:blast` 跳转最后一个
  - `:b buffer_name` 加上tab补全，跳转指定buffer
- window：窗口是可视化的分割区域
  - 一个缓冲区可以分割为多个窗口，每个窗口也可以打开不同缓冲区
  - `ctrl + w` + `s` 水平分割，`ctrl + w` + `v` 垂直分割，或者`:sp` 和 `:vs`（`vsp`）
  - 窗口切换：
    - `Ctrl + w` + `w` 在窗口间循环切换
    - `Ctrl + w` + `h/l/k/j` 切换到左/右/上/下窗口 ，大写方向是移动到窗口
    - `Ctrl + w` + `+` 号，表示扩大当前视口；
    - `Ctrl + w` + `-` 号，表示缩小当前视口；
    - `Ctrl + w` + `=` 号，表示平均当前视口；
    - `Ctrl + w` + `r` 键，会反向调换视口位置；
    - `Ctrl + w` + `q` 键，会关闭当前视口；
    - `Ctrl + w` + `o` 键，会关闭除当前视口以外的所有视口；
- tab：标签页，将窗口分组，是可以容纳一系列窗口的容器（`:h tabpage`）
  - vim的tab和其他编辑器不太一样，可以想象为linux的虚拟桌面，eg：一个tab全用来编辑Python文件，一个tab全用来编辑HTML文件
  - 相比window，tab使用比较少，管理起来比较麻烦
    - `:tabe[dit] {filename}` 在新标签页打开`{filename}`
    - `:tabc[lose]`关闭当前标签及窗口
    - `:tabo[nly]` 只保留活动页，关闭其他标签
    - `Ctrl + w` + `T`关闭当前窗口，移动到下个新标签页
    - `:tabn[ext]` 切换到下个标签页 ，普通模式使用`gt`
    - `:tabp[revious]` 切换到上个标签页，普通模式使用`gT`

### 自动补全

- `ctrl + n + p`补全单词
- `ctrl + x + f`补全文件名
- `ctrl + x + o`补全代码，需要开启文件类型检查（`:filetype on`），安装插件

### 合并文件

可以用冒号 `+r` ( `:r` ) 实现在光标处插入一个文件的内容。

```
:r filename # 可以用Tab键来自动补全另外一个文件的路径
```

### 运行外部命令 `:!`

在 `Vim` 中可以运行一些终端命令，只要先输入 `:!` ，然后接命令名称。

例如：

```
:!ls # 在Vim中打开的文件所在的目录运行ls命令
```



## Vim 配置

### 配色

- 使用`:colorscheme`显示当前主题颜色
- `:colorscheme` + `ctrl + d` 显示所有配色
- `:colorscheme 配色名` 修改配色

### 选项参数

在 `Vim` 被启动后，可以运行一些指令来激活一些选项参数，但是这些选项参数的配置在退出 `Vim` 时会被忘记，例如前面讲解的激活行号。如果希望所在的配置是永久性的，那么需要在家目录（ `cd ~` ）创建一个 `Vim` 的配置文件 `.vimrc` 。

### 常用设置

```
set number 显示行号
syntax on 激活语法高亮
set showcmd 实时看到输入的命令
set ignorecase 搜索时不区分大小写
set hlsearch 高亮搜索
set incsearch 设置增量搜索
set pastetoggle=<F2> 按F2进入粘贴模式，相当于前面的`:set paste`和`:set nopaste`
set mouse=a 激活鼠标，用鼠标选中时相当于进入可视模式
colorscheme hybrid 设置主题
```

`Vim` 配置非常丰富，我们可以通过个性化配置把 `Vim` 打造成属于自己的 `IDE` 等等。在 `github` 上也可以搜索到一些强大的 `Vim` 配置文件。

### 映射

可以映射快捷键

- 基本映射是指在normal模式下的映射，通过`:map`命令来指定，取消映射通过`:unmap`

  - `:map - x` 将`-`映射为`x`，实现删除字符
  - `:map <space> viw` 使用空格来选择这个单词
  - `:map <c-d> dd` 使用Ctrl +d来删除当前行

- 用`nmap / vmap / imap` 定义只在 normal / visual / insert 模式下的映射

  insert模式下，实现删除行Ctrl + d快捷键：`:imap <c-d> <Esc>ddi`

- vim 提供了非递归映射，在map命令上加nore来限制非递归，即使用`nnoremap / vnoremap / inoremap` 

- 设置leader键，`let mapleader = ","`，常用是逗号或空格



## 插件

原始插件安装是通过clone插件代码，如今有很多插件管理器，常见有：vim-plugin、vundle、pathogen、dein.vim、volt等

安装vim-plugin：https://github.com/junegunn/vim-plug

现在完毕后，在`~/.vimrc`中添加：

```vbscript
" 插件管理器开始
call plug#begin()

" 在这中间放置需要的插件
" Plugin options
Plug 'nsf/gocode', { 'tag': 'v.20150303', 'rtp': 'vim' }
Plug 'mhinz/vim-startify'

call plug#end()
```

保持文件，执行`source`，最后`PlugInstall` 执行插件安装

插件地址推荐：https://vimawesome.com/

常用插件：

- mhinz/vim-startify 启动界面
- vim-airline/vim-airline 状态栏美化
- vim-airline/vim-airline-themes
- yggdroot/indentline 代码增加缩进线
- scrooloose/nerdtree 实现文件目录管理
- ctrlpvim/ctrlp.vim 快速搜索并且打开一个文件
- easymotion/vim-easymotion 快速跳转文件任意位置
- tpope/vim-surround 成对编辑修改
- junegunn/fzf.vim 模糊搜索字符或文件
- brooth/far.vim 批量查找替换
- fatih/vim-go golang编写插件
- majutsushi/tagbar 代码浏览
- shougo/deoplete.nvim 代码补全插件

### Tmux

强大的终端复用工具：

- 可以复用终端、分屏、托管进程等
- 在服务器上即使退出服务器也不会被kill，托管进程也很方便
- 方便分割屏幕，实现多个进程共用一个屏幕

[终端复用神器 Tmux](https://zhuanlan.zhihu.com/p/43687973)

